!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).$violent=e()}(this,function(){"use strict";for(var t=["$target","$el","$value","$event","$props","$renderState"],e="",n=0;n<8;n++)t.push("$"+e+"v"),t.push("$"+e+"i"),e+="_";function r(t,e,n,r){t.hasAttribute(n)&&e(t),t.querySelectorAll(r).forEach(e)}t.forEach(function(t){void 0===window[t]&&(window[t]="")});var o=0;function y(t){return void 0===t&&(t="u"),999<(o+=1)&&(o=0),t+Date.now().toString().slice(5,13)+(o+"")}function i(n,r){var o,i,u,c=new Set;return u=r?(i=setTimeout,clearTimeout):(i=requestAnimationFrame,cancelAnimationFrame),function(t,e){c.has(t)||c.add(t),o&&u(o),o=i(function(){o=null,c.forEach(n),c.clear(),e&&e()},r)}}window.$uuid=y;var u=[];function g(e,n,r){console.error(e,n),u.forEach(function(t){t(e,n,r||"")})}var c=/^v-on/;function a(t){function e(o){o.__events||(o.getAttribute("bind-on").split(" ").forEach(function(t){var n=t.replace("v-","");if(c.test(t)){var r=new Function("$el","$event","return "+o.getAttribute(t));o[n]=function(t){var e;o.getAttribute("prevent-"+n)&&t.preventDefault(),o.getAttribute("stop-"+n)&&t.stopPropagation();try{e=r(o,t)}catch(t){g(t,o)}"function"==typeof e&&e(t),A(o.getAttribute("query"))}}}),o.__events=!0)}t.getAttribute("bind-on")&&e(t),t.querySelectorAll("[bind-on]").forEach(e)}function l(i,u,c,a){return new(c=c||Promise)(function(t,e){function n(t){try{o(a.next(t))}catch(t){e(t)}}function r(t){try{o(a.throw(t))}catch(t){e(t)}}function o(e){e.done?t(e.value):new c(function(t){t(e.value)}).then(n,r)}o((a=a.apply(i,u||[])).next())})}function _(n,r){var o,i,u,t,c={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(u=2&e[0]?i.return:e[0]?i.throw||((u=i.return)&&u.call(i),0):i.next)&&!(u=u.call(i,e[1])).done)return u;switch(i=0,u&&(e=[2&e[0],u.value]),e[0]){case 0:case 1:u=e;break;case 4:return c.label++,{value:e[1],done:!1};case 5:c.label++,i=e[1],e=[0];continue;case 7:e=c.ops.pop(),c.trys.pop();continue;default:if(!(u=0<(u=c.trys).length&&u[u.length-1])&&(6===e[0]||2===e[0])){c=0;continue}if(3===e[0]&&(!u||e[1]>u[0]&&e[1]<u[3])){c.label=e[1];break}if(6===e[0]&&c.label<u[1]){c.label=u[1],u=e;break}if(u&&c.label<u[2]){c.label=u[2],c.ops.push(e);break}u[2]&&c.ops.pop(),c.trys.pop();continue}e=r.call(n,c)}catch(t){e=[6,t],i=0}finally{o=u=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}var f=new RegExp('src="./',"g"),s=new RegExp('href="./',"g"),w={},E={},d={};function $(o,i){return l(this,void 0,void 0,function(){var n,r,e;return _(this,function(t){switch(t.label){case 0:return n=[],r=[],o.querySelectorAll(i).forEach(function(t){var e=document.createElement("script");e.setAttribute("src",t.getAttribute("src")),n.push(e),r.push(new Promise(function(t){return e.onload=t})),t.remove()}),0<n.length?((e=document.head).append.apply(e,n),[4,Promise.all(r)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}function v(t){t.querySelectorAll("template[component]").forEach(function(o){return l(this,void 0,void 0,function(){var e,n,r;return _(this,function(t){return!(e=o.getAttribute("component"))||w[e]||((n=document.createElement("div")).innerHTML=o.innerHTML,(r=n.querySelector("script:not([src])"))&&(E[e]=new Function("$parent","$id","$props","$ref","$refs",r.innerHTML),r.remove(),o.remove()),w[e]=n.innerHTML),[2]})})})}function q(e){var t=e.getAttribute("if");if(t){var n=void 0;try{n=new Function("return "+t)()}catch(t){g(t,e)}if(!n)return!1}var r=e.getAttribute("route");if(r&&1!==(location.hash||"/").indexOf(r))return!1;return!0}function h(t){t.querySelectorAll("template[by]:not([uuid])").forEach(function(A){return l(this,void 0,void 0,function(){function e(t,e){return document.body.querySelector("["+h[t]+"]")}function n(t){return document.body.querySelectorAll("["+h[t]+"]")}var r,o,i,u,c,a,l,f,s,d,v,h,m,b,p;return _(this,function(t){switch(t.label){case 0:if(!(r=A.getAttribute("by")))return[2];if(!q(A))return[2];if((o=A.content.querySelector("[loading]:not([use-loading])"))&&(i=y(),o.setAttribute("use-loading",i),(u=o.cloneNode(!0)).setAttribute(i,"1"),A.insertAdjacentElement("afterend",u)),!(c=w[r]))return[2];a=A.getAttribute("props")||"{}",l=y(),f=r+"_"+l,s=r+"_props_"+l,A.setAttribute("uuid",f),A.innerHTML=A.innerHTML.replace(/\$renderState/g,f);try{window[s]=new Function("return "+a)()}catch(t){g(t,A,a)}return d=document.createElement("div"),v=(v=(v=c.replace(/\$state/g,f)).replace(/\$id/g,"'"+f+"'")).replace(/\$props/g,s),d.innerHTML=v,d.querySelectorAll("*").forEach(function(t,e){t.setAttribute(f,e+1)}),d.querySelectorAll("slot").forEach(function(t){var e=t.getAttribute("name"),n=A.content.querySelector('[slot="'+e+'"]');n&&(Array.from(t.attributes).forEach(function(t){n.getAttribute(t.name)||n.setAttribute(t.name,t.value)}),d.replaceChild(n,t))}),h={},d.querySelectorAll("[ref]").forEach(function(t){var e=t.getAttribute("ref");h[e]="ref_"+e+"_"+f,t.removeAttribute("ref"),t.setAttribute(h[e],"1")}),S(d),d.querySelector("[defer]")?[4,$(d,"script[src]:not([defer])")]:[3,6];case 1:return t.sent(),[4,$(d,'script[defer=""]')];case 2:return t.sent(),[4,$(d,'script[defer="1"]')];case 3:return t.sent(),[4,$(d,'script[defer="2"]')];case 4:return t.sent(),[4,$(d,'script[defer="3"]')];case 5:return t.sent(),[3,8];case 6:return[4,$(d,"script[src]")];case 7:t.sent(),t.label=8;case 8:if((m=A.content.querySelector("[use-loading]"))&&document.body.querySelectorAll("["+m.getAttribute("use-loading")+"]").forEach(function(t){t.remove()}),b=E[r])try{p=b(A.parentElement,f,window[s],e,n)}catch(t){g(t,A,b)}return A.insertAdjacentHTML("afterend",d.innerHTML),Promise.resolve(p).then(function(t){window[f]=t,requestAnimationFrame(function(){H(A.parentElement,function(){t.$mount&&t.$mount(window[f])})})}),[2]}})})})}function m(t){!function(i){i.querySelectorAll("template[fetch]:not([fetch-loaded])").forEach(function(t){t.setAttribute("fetch-loaded","1");var o=t.getAttribute("fetch");o&&!d[o]&&(d[o]=!0,fetch(o,{mode:"cors",cache:t.getAttribute("cache")||"no-cache"}).then(function(t){return t.text()}).then(function(t){if(t){var e=document.createElement("div"),n=o.split("/");n.pop();var r=n.join("/")+"/";t=(t=(t=t.replace(f,'src="'+r)).replace(s,'href="'+r)).replace(/\$dir/,"'"+r+"'"),e.innerHTML=t,v(e),requestAnimationFrame(function(){m(i)})}}).catch(function(t){d[o]=!1}))})}(t),v(t),requestAnimationFrame(function(){h(t)})}var b=/^v-/,p=/^v-on/;function S(t){t.querySelectorAll("*").forEach(function(t){if(!t.getAttribute("bind-on")&&!t.getAttribute("bind-attr")){var e="",n="";Array.from(t.attributes).forEach(function(t){p.test(t.name)?n+=t.name+" ":b.test(t.name)&&(e+=t.name+" ")}),e&&t.setAttribute("bind-attr",e.trim()),n&&t.setAttribute("bind-on",n.trim())}})}function A(t){t=t&&"*"!==t?t:"[violent]",document.querySelectorAll(t).forEach(function(t){F(t)})}var F=i(function(t){T(t)}),x=[function(t){t.querySelectorAll("template[uuid]").forEach(function(t){var e=t.getAttribute("uuid");e&&(q(t)||(t.removeAttribute("uuid"),document.body.querySelectorAll("["+e+"]").forEach(function(t){t.remove()})))})},h,function(t){r(t,function(e){var t;try{"function"==typeof(t=new Function("$el","return "+e.getAttribute("if"))(e))&&(t=t())}catch(t){g(t,e)}var n=e.getAttribute("uuid");if(t){if(!n){n=y("if"),e.setAttribute("uuid",n);var r=document.createElement("div");r.innerHTML=e.innerHTML,r.querySelectorAll("*").forEach(function(t){t.setAttribute(n,"1")}),e.insertAdjacentHTML("afterend",r.innerHTML)}}else n&&(document.body.querySelectorAll("["+n+"]").forEach(function(t){t.remove()}),e.removeAttribute("uuid"))},"if","template[if]:not([by])")},function(t){function e(r){if(!r.__forcode){r.__forcode=r.getAttribute("forin"),r.__html=r.innerHTML;try{r.__forData=new Function("$el","return "+r.__forcode)(r)}catch(t){g(t,r)}}var t=r.__forData;if(t&&r.getAttribute("for-length")!=t.length){var o=r.__html,i="";t.forEach(function(t,e){var n=o.replace(/\$v/g,r.__forcode+"["+e+"]");n=(n=n.replace(/\$i/g,e)).replace(/\$_/g,"$"),i+=n}),r.innerHTML=i,r.setAttribute("for-length",t.length),a(r)}}var n=[],r=t.querySelectorAll("[forin]"),o=r.length;r.forEach(function(t,e){n[o-e-1]=t}),n.forEach(e),t.hasAttribute("forin")&&e(t)},function(t){r(t,function(e){var t;try{"function"==typeof(t=new Function("$el","return "+e.getAttribute("show"))(e))&&(t=t())}catch(t){g(t,e)}t?e.style.removeProperty("display"):e.style.display="none"},"show","[show]")},function(t){r(t,function(u){var t,c=u.getAttribute("model"),a=u.getAttribute("query");if(function(t){var e=t.tagName.toLowerCase(),n=t.type;t.__modelName="select"===e?"onchange":"input"===e||"textarea"===e?"oninput":"onclick","select"===e?t.__valueName="value":"checkbox"===n?(t.__valueName="checked",t.__valueIsBool=!0):"radio"===n?(t.__modelName="onclick",t.__valueName="checked",t.__valueIsBool=!0):t.__valueName="value"}(u),u.__models||(u[u.__modelName]=function(t){u.getAttribute("prevent-"+u.__modelName)&&t.preventDefault(),u.getAttribute("stop-"+u.__modelName)&&t.stopPropagation();var e,n,r=t.target&&t.target[u.__valueName]||"";if(u.__valueIsBool){var o=u.getAttribute("v-value"),i=u.getAttribute("value");e=o?c+"["+o+"] = !"+c+"["+o+"]; return "+c+"["+o+"];":i?c+"['"+i+"'] = !"+c+"['"+i+"']; return "+c+"['"+i+"'];":c+"="+!!r+"; return "+c+";"}else e=c+"=`"+r+"`; return "+c+";";try{n=new Function("$el",e)(u)}catch(t){g(t,u)}u[u.__valueName]!==n&&(u[u.__valueName]=n),A(a)},u.__models=!0),u.__valueIsBool){var e=u.getAttribute("v-value"),n=u.getAttribute("value");if(n)try{t=new Function("return "+c+"['"+n+"']")()}catch(t){g(t,u)}else if(e)try{t=new Function("return "+c+"["+e+"]")()}catch(t){g(t,u)}else try{t=new Function("return "+c)()||""}catch(t){console.error(u,"return "+c)}}else try{t=new Function("return "+c)()||""}catch(t){console.error(u,"return "+c)}u[u.__valueName]!==t&&requestAnimationFrame(function(){u[u.__valueName]=t})},"model","[model]")},function(t){r(t,function(e){var t;e.getAttribute("text-save")||e.setAttribute("text-save",e.getAttribute("text")||e.textContent);try{"function"==typeof(t=new Function("$el","return "+e.getAttribute("text-save"))(e))&&(t=t())}catch(t){g(t,e)}e.textContent!==t&&(e.textContent=t)},"text","[text]")},function(t){r(t,function(n){n.getAttribute("bind-attr").split(" ").forEach(function(t){var e;try{"function"==typeof(e=new Function("$el","return "+n.getAttribute(t))(n))&&(e=e())}catch(t){g(t,n)}n.setAttribute(t.replace("v-",""),e)})},"bind-attr","[bind-attr]")},function(t){r(t,function(e){try{var t=new Function("$el",e.getAttribute("watch"))(e);"function"==typeof t&&t()}catch(t){g(t,e)}},"watch","[watch]")}];function T(e){x.forEach(function(t){t(e)})}var L=[m,a],H=i(function(e){T(e),L.forEach(function(t){t(e)})}),M={update:H,middlewareByUpdate:x,middlewareByInit:L,Reducer:function(n,r){var o,i,u;return u=r?(i=setTimeout,clearTimeout):(i=requestAnimationFrame,cancelAnimationFrame),function(t,e){o&&u(o),o=i(function(){o=null,n(t),e&&e()},r)}},ReducerList:i};return window.addEventListener("load",function(){document.querySelectorAll("[violent]").forEach(function(t){S(t),H(t),setTimeout(function(){"hidden"===t.style.visibility&&(t.style.visibility="visible")},200)})}),M});
