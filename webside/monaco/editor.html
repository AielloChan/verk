<template component="monaco_editor">
  <div ref="editor" css="w-12/12 h-12/12" name="root"></div>
  <script type="text/javascript" src="./vs/loader.js"></script>
  <script>
    return new Promise(function (res) {
      const { id, ref, props, verk } = $hook;

      const state = {};

      function init() {
        const editor = window.monaco.editor.create(ref("editor"), {
          value: ["function x() {", '\tconsole.log("Hello world!");', "}"].join(
            "\n"
          ),
          language: "javascript",
          automaticLayout: true,
          fontSize: 13,
          scrollbar: {
            vertical: "hidden",
            verticalScrollbarSize: 7,
            verticalHasArrows: false,
            horizontalSliderSize: 7,
            horizontalHasArrows: false,
            // horizontal: "hidden",
          },
          // lineNumbers: "off",
          lineNumbersMinChars: 2,
          lineDecorationsWidth: 0,
          codeLens: false,
          cursorStyle: "line-thin",
          cursorBlinking: "blink",
          // theme: "verk",
          find: {
            addExtraSpaceOnTop: true,
          },
          renderLineHighlight: "all",
          renderIndentGuides: false,
          minimap: {
            // enabled: false,
            // showSlider: "always",
            scale: 2,
            maxColumn: 20,
          },
          // wrappingIndent: "indent",
          // wordWrap: "on",
          ...props.options,
        });
        if (props.onChange) {
          const editorModel = editor.getModel();
          const reducer = verk.Reducer(function () {
            const v = editor.getValue();
            props.onChange(v);
          }, props.time || 60);
          editorModel.onDidChangeContent(reducer);
        }
        state.editor = editor;
        if (props.onMount) {
          props.onMount(state);
        }
        res(state);
      }

      if (window.monaco) {
        init();
      } else {
        require.config({ paths: { vs: $dir + "/vs" } });
        window.MonacoEnvironment = {
          getWorkerUrl: function (workerId, label) {
            return $dir + "/monaco-editor-worker-loader-proxy.js";
          },
        };
        require(["vs/editor/editor.main"], function (monaco) {
          window.monaco = monaco;
          init();
        });
      }
    });
  </script>
</template>
