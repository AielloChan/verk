<template v-component="editor">
  <slot v-ref="editor" v-css="h-6xl w-12/12 bg-gray-100" name="editor"></slot>
  <script type="text/javascript" src="./vs/loader.js"></script>
  <script>
    const state = {
      $mount: function () {
        function onInit() {
          const editor = window.monaco.editor.create($ref("editor"), {
            value: [
              "function x() {",
              '\tconsole.log("Hello world!");',
              "}",
            ].join("\n"),
            language: "javascript",
            automaticLayout: true,
            fontSize: 13,
            scrollbar: {
              // vertical: "hidden",
              verticalScrollbarSize: 7,
              verticalHasArrows: false,
              horizontalSliderSize: 0,
              horizontalHasArrows: false,
              horizontal: "hidden",
            },
            lineNumbersMinChars: 2,
            lineNumbers: "off",
            lineDecorationsWidth: 0,
            codeLens: false,
            cursorStyle: "line-thin",
            cursorBlinking: "blink",
            theme: "poet",
            find: {
              addExtraSpaceOnTop: true,
            },
            renderLineHighlight: "all",
            renderIndentGuides: false,
            minimap: {
              enabled: false,
              showSlider: "always",
              scale: 2,
              maxColumn: 20,
            },
            // wrappingIndent: "indent",
            wordWrap: "on",
            ...$props.options,
          });

          if ($props.onChange) {
            const editorModel = editor.getModel();
            const reducer = $verk.Reducer(function () {
              $props.onChange(editor.getValue());
            }, $props.time || 300);
            editorModel.onDidChangeContent(reducer);
          }
          state.editor = editor;
        }
        if (window.monaco) {
          onInit();
          return;
        }
        require.config({ paths: { vs: $dir + "/vs" } });
        window.MonacoEnvironment = {
          getWorkerUrl: function (workerId, label) {
            return $dir + "/monaco-editor-worker-loader-proxy.js";
          },
        };

        const m = require(["vs/editor/editor.main"], function (monaco) {
          window.monaco = monaco;
          onInit();
        });
      },
    };
    return state;
  </script>
</template>
